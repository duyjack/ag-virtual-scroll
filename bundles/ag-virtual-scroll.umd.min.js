!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common"),require("rxjs")):"function"==typeof define&&define.amd?define("ag-virtual-scroll",["exports","@angular/core","@angular/common","rxjs"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["ag-virtual-scroll"]={},t.ng.core,t.ng.common,t.rxjs)}(this,(function(t,e,i,n){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */Object.create;function r(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],n=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function s(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,r,s=i.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)o.push(n.value)}catch(t){r={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}return o}Object.create;var o=function(t){Object.assign(this,t)},c=function(){function t(t,i){this.elRef=t,this.appRef=i,this.class=!0,this.sticky=!1,this.viewOk=!1,this.onStickyChange=new e.EventEmitter(!1),this.isSticked=!1}return Object.defineProperty(t.prototype,"el",{get:function(){return this.elRef&&this.elRef.nativeElement},enumerable:!1,configurable:!0}),t.prototype.ngOnInit=function(){},t.prototype.ngAfterViewInit=function(){},t.prototype.ngOnChanges=function(t){"sticky"in t&&this.onStickyChange.next(this.sticky)},t.prototype.forceUpdateInputs=function(){this.viewOk=!1,this.appRef.tick(),this.viewOk=!0},t.prototype.getHtml=function(){return this.el.outerHTML},t}();c.decorators=[{type:e.Component,args:[{selector:"ag-vs-item",template:'<ng-template #temp>\n    <ng-content></ng-content>\n</ng-template>\n\n<ng-container *ngIf="!isSticked" [ngTemplateOutlet]="temp"></ng-container>',styles:[":host {\n            display: block;\n        }\n        \n        :host > ng-template {\n            display: inherit;\n            width: inherit;\n            height: inherit;\n        }"]}]}],c.ctorParameters=function(){return[{type:e.ElementRef},{type:e.ApplicationRef}]},c.propDecorators={class:[{type:e.HostBinding,args:["class.ag-vs-item"]}],temp:[{type:e.ViewChild,args:["temp",{static:!1}]}],sticky:[{type:e.Input,args:["sticky"]}]};var h=function(){function t(t,i){this.elRef=t,this.renderer=i,this.minRowHeight=40,this.height="auto",this.originalItems=[],this.onItemsRender=new e.EventEmitter,this.prevOriginalItems=[],this.items=[],this.subscripAllVsItem=[],this._indexCurrentSticky=-1,this.indexNextSticky=-1,this.indexesPrevStick=[],this.currentScroll=0,this.contentHeight=0,this.paddingTop=0,this.startIndex=0,this.endIndex=0,this.isTable=!1,this.scrollIsUp=!1,this.lastScrollIsUp=!1,this.previousItemsHeight=[],this.containerWidth=0}return Object.defineProperty(t.prototype,"indexCurrentSticky",{get:function(){return this._indexCurrentSticky},set:function(t){this._indexCurrentSticky=t;var e=t===this.indexPrevSticky;!e&&t>=0?this.findCurrentStickyByIndex():(e||(this.indexNextSticky=-1),this.currentStickyItem&&(this.currentStickyItem.comp.isSticked=!1),this.currentStickyItem=null),this.prepareDataItems()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"indexPrevSticky",{get:function(){return this.indexesPrevStick.length?this.indexesPrevStick[0]:-1},set:function(t){t<0?this.indexesPrevStick.length>0&&(this.indexesPrevStick=this.indexesPrevStick.slice(1)):this.indexesPrevStick.some((function(e){return e===t}))||this.indexesPrevStick.push(t),this.indexesPrevStick.length&&(this.indexesPrevStick=this.indexesPrevStick.sort((function(t,e){return e-t})))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"itemsNoSticky",{get:function(){var t=this;return this.currentStickyItem?this.items.filter((function(e){return t.originalItems[t.currentStickyItem.index]!==e})):this.items},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"vsItems",{get:function(){return this.queryVsItems&&this.queryVsItems.toArray()||[]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"numberItemsRendred",{get:function(){return this.endIndex-this.startIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"el",{get:function(){return this.elRef&&this.elRef.nativeElement},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"itemsContainerEl",{get:function(){return this.itemsContainerElRef&&this.itemsContainerElRef.nativeElement},enumerable:!1,configurable:!0}),t.prototype.ngAfterViewInit=function(){var t=this;this.queryVsItems.changes.subscribe((function(){return t.checkStickItem(t.scrollIsUp)}))},t.prototype.ngOnInit=function(){this.renderer.listen(this.el,"scroll",this.onScroll.bind(this))},t.prototype.ngOnChanges=function(t){var e=this;setTimeout((function(){"height"in t&&(e.el.style.height=e.height),"minRowHeight"in t&&"string"==typeof e.minRowHeight&&(parseInt(e.minRowHeight)?e.minRowHeight=parseInt(e.minRowHeight):(console.warn('The [min-row-height] @Input is invalid, the value must be of type "number".'),e.minRowHeight=40)),"originalItems"in t&&(e.originalItems||(e.originalItems=[]),e.currentAndPrevItemsAreDiff()?(e.previousItemsHeight=new Array(e.originalItems.length).fill(null),0!==e.el.scrollTop?e.el.scrollTop=0:(e.currentScroll=0,e.prepareDataItems(),e.checkIsTable(),e.queryVsItems.notifyOnChanges())):(e.originalItems.length>e.prevOriginalItems.length&&(e.previousItemsHeight=e.previousItemsHeight.concat(new Array(e.originalItems.length-e.prevOriginalItems.length).fill(null))),e.prepareDataItems(),e.checkIsTable(),e.queryVsItems.notifyOnChanges()),e.prevOriginalItems=e.originalItems)}))},t.prototype.ngAfterContentChecked=function(){var t=this.itemsContainerEl&&this.itemsContainerEl.clientWidth;t!==this.containerWidth&&(this.containerWidth=t),this.manipuleRenderedItems()},t.prototype.currentAndPrevItemsAreDiff=function(){if(this.originalItems.length>=this.prevOriginalItems.length){for(var t=this.prevOriginalItems.length-1,e=0;e<=t;e++)if(this.originalItems[e]!==this.prevOriginalItems[e])return!0;return!1}return!0},t.prototype.onScroll=function(){var t=this.el.scrollTop<this.currentScroll;this.currentScroll=this.el.scrollTop,this.prepareDataItems(),this.isTable=this.checkIsTable(),this.lastScrollIsUp=this.scrollIsUp,this.scrollIsUp=t,this.queryVsItems.notifyOnChanges()},t.prototype.prepareDataItems=function(){this.registerCurrentItemsHeight(),this.prepareDataVirtualScroll()},t.prototype.registerCurrentItemsHeight=function(){for(var t=this.getInsideChildrens(),e=0;e<t.length;e++){var i=t[e],n=this.startIndex+e;this.previousItemsHeight[n]=i.getBoundingClientRect().height}},t.prototype.getDimensions=function(){var t,e,i=this,n={contentHeight:0,paddingTop:0,itemsThatAreGone:0};if(n.contentHeight=this.originalItems.reduce((function(t,e,n){var r=i.previousItemsHeight[n];return t+(r||i.minRowHeight)}),0),this.currentScroll>=this.minRowHeight){var s=0,o=0,c=this.currentScroll;try{for(var h=r(this.previousItemsHeight),a=h.next();!a.done;a=h.next()){var l=a.value,u=l||this.minRowHeight;if(!(c>=u))break;s+=u,c-=u,o++}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=h.return)&&e.call(h)}finally{if(t)throw t.error}}n.paddingTop=s,n.itemsThatAreGone=o}return n},t.prototype.prepareDataVirtualScroll=function(){var t=this.getDimensions();this.contentHeight=t.contentHeight,this.paddingTop=t.paddingTop,this.startIndex=t.itemsThatAreGone,this.endIndex=Math.min(this.startIndex+this.numberItemsCanRender(),this.originalItems.length-1),this.indexCurrentSticky>=0&&(this.startIndex>this.indexCurrentSticky||this.endIndex<this.indexCurrentSticky)?(this.currentStickyItem&&(this.currentStickyItem.outside=!0),this.items=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(s(arguments[e]));return t}(this.originalItems.slice(this.startIndex,Math.min(this.endIndex+1,this.originalItems.length)),[this.originalItems[this.indexCurrentSticky]])):(this.currentStickyItem&&(this.currentStickyItem.outside=!1),this.items=this.originalItems.slice(this.startIndex,Math.min(this.endIndex+1,this.originalItems.length))),this.onItemsRender.emit(new o({items:this.itemsNoSticky,startIndex:this.startIndex,endIndex:this.endIndex,length:this.itemsNoSticky.length})),this.manipuleRenderedItems()},t.prototype.numberItemsCanRender=function(){return Math.floor(this.el.clientHeight/this.minRowHeight)+2},t.prototype.manipuleRenderedItems=function(){for(var t=this.getInsideChildrens(),e=0;e<t.length;e++){var i=t[e];if("none"!==i.style.display){var n=this.startIndex+e;i.style.minHeight=this.minRowHeight+"px",i.style.height=this.minRowHeight+"px";var r=(n+1)%2==0?"even":"odd",s="even"==r?"odd":"even";i.classList.add("ag-virtual-scroll-"+r),i.classList.remove("ag-virtual-scroll-"+s)}}},t.prototype.getInsideChildrens=function(){var t=this.itemsContainerEl.children;return t.length>0&&"TABLE"===t[0].tagName.toUpperCase()&&(t=t[0].children).length>0&&(t="TBODY"===t[0].tagName.toUpperCase()?t[0].children:t[1].children),t},t.prototype.checkIsTable=function(){var t=this.itemsContainerEl.children;if(t.length>0&&"TABLE"===t[0].tagName.toUpperCase()){if((t=t[0].children).length>0)if("THEAD"===t[0].tagName.toUpperCase())t[0].style.transform="translateY("+Math.abs(this.paddingTop-this.currentScroll)+"px)";return!0}return!1},t.prototype.checkStickItem=function(t){var e=this;!this.isTable&&this.vsItems.length>0?this.updateVsItems().subscribe((function(){if(e.indexCurrentSticky>=0){if(!e.currentStickyItem)return void e.findCurrentStickyByIndex(!0);-1===e.indexNextSticky&&(e.indexNextSticky=e.getIndexNextSticky(t)),e.currentStickIsEnded(t)&&(t?e.indexPrevSticky>=0?e.setPrevAsCurrentSticky():(e.indexCurrentSticky=e.getIndexCurrentSticky(t),e.indexCurrentSticky>=0?e.indexNextSticky=e.getIndexNextSticky(t):e.indexNextSticky=null):(e.indexPrevSticky=e.indexCurrentSticky,e.indexCurrentSticky=e.getIndexCurrentSticky(t),e.indexNextSticky=e.getIndexNextSticky(t)))}else e.indexCurrentSticky=e.getIndexCurrentSticky(t),e.indexNextSticky=e.getIndexNextSticky(t)})):(this.indexCurrentSticky=-1,this.indexNextSticky=-1)},t.prototype.findCurrentStickyByIndex=function(t){var e,i,n=this;void 0===t&&(t=!1);var s=0,o=this.vsItems.length-1;if(this.vsItems.length-this.numberItemsCanRender()>0&&!this.vsItems.some((function(t,e){return n.indexCurrentSticky===n.startIndex+e}))){s=o;var c=this.vsItems[o],h=this.indexCurrentSticky,l=this.previousItemsHeight.slice(0,h).reduce((function(t,e){return t+(e||n.minRowHeight)}),0);c.isSticked=!0,this.currentStickyItem=new a({comp:c,index:h,vsIndex:s,offsetTop:l,height:c.el.offsetHeight,outside:!0})}else try{for(var u=r(this.vsItems),d=u.next();!d.done;d=u.next()){c=d.value,h=this.startIndex+s;if(this.indexCurrentSticky===h){l=this.previousItemsHeight.slice(0,h).reduce((function(t,e){return t+(e||n.minRowHeight)}),0);c.isSticked=!0,this.currentStickyItem=new a({comp:c,index:h,vsIndex:s,offsetTop:l,height:c.el.offsetHeight});break}s++}}catch(t){e={error:t}}finally{try{d&&!d.done&&(i=u.return)&&i.call(u)}finally{if(e)throw e.error}}if(t&&this.currentStickyItem){var p=this.currentStickyItem.height,m=this.paddingTop+p+Math.abs(this.el.scrollTop-this.paddingTop),y=this.indexNextSticky>=0?this.previousItemsHeight.slice(0,this.indexNextSticky).reduce((function(t,e){return t+(e||n.minRowHeight)}),0):null;if(null!==y&&m>=y){var g=m-y;if(g>=p)return this.currentStickyItem.diffTop=p,!0;this.currentStickyItem.diffTop=g}else this.currentStickyItem.diffTop=0}},t.prototype.setPrevAsCurrentSticky=function(){this.currentStickyItem&&this.currentStickyItem.comp.sticky&&(this.indexNextSticky=this.indexCurrentSticky),this.indexCurrentSticky=this.indexPrevSticky,this.indexPrevSticky=-1},t.prototype.getIndexCurrentSticky=function(t){var e,i,n=this,s=0;try{for(var o=r(this.vsItems),c=o.next();!c.done;c=o.next()){var h=c.value,a=s+this.startIndex,l=this.previousItemsHeight.slice(0,a).reduce((function(t,e){return t+(e||n.minRowHeight)}),0);if(h&&h.sticky&&this.el.scrollTop>=l&&(-1===this.indexCurrentSticky||a!==this.indexCurrentSticky))return a;s++}}catch(t){e={error:t}}finally{try{c&&!c.done&&(i=o.return)&&i.call(o)}finally{if(e)throw e.error}}return-1},t.prototype.getIndexNextSticky=function(t){var e,i;if(this.indexCurrentSticky>=0){var n=0;try{for(var s=r(this.vsItems.slice(0,this.numberItemsCanRender())),o=s.next();!o.done;o=s.next()){var c=o.value,h=n+this.startIndex;if(c.sticky&&h>this.indexCurrentSticky)return h;n++}}catch(t){e={error:t}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(e)throw e.error}}}return-1},t.prototype.currentStickIsEnded=function(t){var e=this,i=this.currentStickyItem.height;if(!t||this.currentStickyItem.diffTop>0){var n=this.paddingTop+i+Math.abs(this.el.scrollTop-this.paddingTop),r=this.indexNextSticky>=0?this.previousItemsHeight.slice(0,this.indexNextSticky).reduce((function(t,i){return t+(i||e.minRowHeight)}),0):null;if(null!==r&&n>=r){var s=n-r;if(s>=i)return this.currentStickyItem.diffTop=i,!0;this.currentStickyItem.diffTop=s}else this.currentStickyItem.diffTop=0}else{if((n=this.paddingTop+Math.abs(this.el.scrollTop-this.paddingTop))<=this.currentStickyItem.offsetTop)return!0}return!1},t.prototype.updateVsItems=function(){var t=this;return new n.Observable((function(e){t.subscripAllVsItem.length&&(t.subscripAllVsItem.forEach((function(t){return t.subscrip.unsubscribe()})),t.subscripAllVsItem=[]);var i=setInterval((function(){var n=t.vsItems.length-t.numberItemsCanRender(),r=t.vsItems.length-1;t.vsItems.every((function(e,i){var s=t.startIndex+i;n>0&&i===r&&(s=t.indexCurrentSticky),t.currentStickyItem&&e===t.currentStickyItem.comp||(e.isSticked=!1),t.subscripAllVsItem.some((function(t){return t.comp===e}))||t.subscripAllVsItem.push({comp:e,subscrip:e.onStickyChange.subscribe((function(i){t.onStickyComponentChanged(e,s)}))});try{e.forceUpdateInputs()}catch(t){return!1}return!0}))&&(clearInterval(i),t.manipuleRenderedItems(),e.next())}))}))},t.prototype.onStickyComponentChanged=function(t,e){if(e===this.indexCurrentSticky)t.sticky||(this.indexPrevSticky>=0?this.setPrevAsCurrentSticky():(this.indexCurrentSticky=this.getIndexCurrentSticky(!1),this.indexCurrentSticky>=0?this.indexNextSticky=this.getIndexNextSticky(!1):this.indexNextSticky=null));else if(-1!==this.indexCurrentSticky&&e<this.indexCurrentSticky||e===this.indexPrevSticky)t.sticky?this.indexPrevSticky=e:this.indexesPrevStick=this.indexesPrevStick.filter((function(t){return t!==e}));else{if(!(-1!==this.indexCurrentSticky&&e>this.indexCurrentSticky||e===this.indexNextSticky))return;t.sticky&&(-1===this.indexNextSticky||e<this.indexNextSticky)?this.indexNextSticky=e:t.sticky||(this.indexNextSticky=-1)}this.queryVsItems.notifyOnChanges()},t.prototype.ngOnDestroy=function(){},t}();h.decorators=[{type:e.Component,args:[{selector:"ag-virtual-scroll",template:'<div class="content-height" [style.height.px]="contentHeight"></div>\n<div #itemsContainer class="items-container" [style.transform]="\'translateY(\' + paddingTop + \'px)\'" [ngClass]="{ \'sticked-outside\': currentStickyItem?.outside }">\n    <ng-content></ng-content>\n</div>\n<ag-vs-item *ngIf="currentStickyItem?.comp && currentStickyItem.comp.isSticked"\n    [class]="currentStickyItem.comp.el.classList.value | stickedClasses"\n    [style.top.px]="currentScroll - (currentStickyItem.diffTop ? currentStickyItem.diffTop : 0)"\n    [style.height.px]="currentStickyItem.height"\n    [style.minHeight.px]="currentStickyItem.height"\n>\n    <ng-container [ngTemplateOutlet]="currentStickyItem.comp.temp"></ng-container>\n</ag-vs-item>',styles:["\n        :host {\n            display: block;\n            position: relative;\n            height: 100%;\n            width: 100%;\n            overflow-y: auto;\n        }\n\n        :host .content-height {\n            width: 1px;\n            opacity: 0;\n        }\n\n        :host .items-container {\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n        }\n\n        :host::ng-deep .items-container.sticked-outside > .ag-vs-item:last-child {\n            position: absolute;\n            top: 0;\n            left: -100%;\n        }\n\n        :host::ng-deep > .ag-vs-item {\n            position: absolute;\n            top: 0;\n            left: 0;\n            box-shadow: 0 5px 5px rgba(0, 0, 0, .1);\n            background: #FFF;\n        }"]}]}],h.ctorParameters=function(){return[{type:e.ElementRef},{type:e.Renderer2}]},h.propDecorators={itemsContainerElRef:[{type:e.ViewChild,args:["itemsContainer",{static:!0}]}],queryVsItems:[{type:e.ContentChildren,args:[c]}],minRowHeight:[{type:e.Input,args:["min-row-height"]}],height:[{type:e.Input,args:["height"]}],originalItems:[{type:e.Input,args:["items"]}],onItemsRender:[{type:e.Output}]};var a=function(t){this.offsetTop=0,this.diffTop=0,this.isUp=!1,this.height=0,this.outside=!1,t&&Object.assign(this,t)},l=function(){function t(){}return t.prototype.transform=function(t){return t?Math.abs(t):t},t}();l.decorators=[{type:e.Pipe,args:[{name:"mathAbs"}]}],l.ctorParameters=function(){return[]};var u=function(){function t(){this.exceptionClasses=["ag-virtual-scroll-odd","ag-virtual-scroll-even"]}return t.prototype.transform=function(t){var e=this;return t?(t.includes(" ")?t.split(" "):[t]).filter((function(t){return!e.exceptionClasses.some((function(e){return e===t}))})).join(" "):""},t}();u.decorators=[{type:e.Pipe,args:[{name:"stickedClasses"}]}],u.ctorParameters=function(){return[]};var d=function(){};d.decorators=[{type:e.NgModule,args:[{imports:[i.CommonModule],declarations:[h,c,l,u],exports:[h,c],entryComponents:[h,c]}]}],t.AgVirtualScrollModule=d,t.AgVirtualSrollComponent=h,t.AgVsItemComponent=c,t.AgVsRenderEvent=o,t.StickyItem=a,t.ɵa=l,t.ɵb=u,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=ag-virtual-scroll.umd.min.js.map